"use strict";var AppGraphicAdmin={index:function(e){var t=e.scope,a=e.periodProductId,n={};return new Vue({el:"#"+t,data:function(){return{graphics:[],templates:[],grapichSelected:Object.create({}),grapichsLoad:!1,templatesLoad:!1,templateProcess:!1,template:{},masterTemplates:[]}},created:function(){n=this},mounted:function(){n.initialize()},watch:{},computed:{},methods:{initialize:function(){n.onGraphics()},onGraphics:function(){n.grapichsLoad=!1,helper.post("/admin/linea-grafica/list").then((function(e){var t;if(!e.success)throw e.message;n.graphics=e.data.graphics,n.grapichsLoad=!0,(null===(t=n.graphics)||void 0===t?void 0:t.length)>0?n.onTemplates(0):n.templatesLoad=!0})).catch((function(e){sweet2.error({html:e})}))},onTemplates:function(e){if(n.templateProcess)sweet2.error({html:"Hay un proceso que se esta ejecutando"});else{n.templates=[],n.templateProcess=!0,n.templatesLoad=!1,n.grapichSelected=n.graphics[e];var t=new FormData;t.append("userId",AppMain.userId),t.append("periodProductId",a),t.append("all",1),helper.post("/admin/linea-grafica/"+n.grapichSelected.id+"/templates",t).then((function(e){if(n.templatesLoad=!0,!e.success)throw e.message;n.templates=e.data.templates,n.templateProcess=!1})).catch((function(e){console.log(e),n.templateProcess=!1,sweet2.error({html:e})}))}},onFormProductLink:function(){n.masterTemplates=[],sweet2.loading(),helper.post("/admin/vinculaciones/"+a+"/linea-grafica/"+n.grapichSelected.id+"/maestras").then((function(e){if(!e.success)throw e.message;n.masterTemplates=e.data.masterTemplates,sweet2.loading(!1),bootstrap.Modal.getOrCreateInstance(document.getElementById("modalLinkProduct")).show()})).catch((function(e){console.log(e),sweet2.error({html:e})}))},onProductLink:function(e){e.preventDefault();var t=new FormData(e.target);t.append("companyId",window.AppMain.companyId),sweet2.loading(),helper.post("/admin/vinculaciones/"+a+"/plantillas/save",t).then((function(e){if(!e.success)throw e.message;var t=e.data.template;n.onActiveTemplate(),bootstrap.Modal.getOrCreateInstance(document.getElementById("modalLinkProduct")).hide(),sweet2.show({type:"success",title:e.message,html:"<h5>Recuerda</h5><p>De ingresar al panel complementario para sincrozinzar los datos del producto a la plantilla</p>",confirmButtonText:"Ingresar",onOk:function(){n.onViewerFile(t)}})})).catch((function(e){console.log(e),sweet2.error({html:e})}))},onRemove:function(e){sweet2.question({title:"¿Estás seguro de eliminar esta plantilla?",onOk:function(){sweet2.loading(),helper.post("/admin/vinculaciones/plantillas/"+e+"/remove").then((function(e){if(!e.success)throw e.message;n.onActiveTemplate(),sweet2.success({html:e.message})})).catch((function(e){console.log(e),sweet2.error({html:e})}))}})},onActiveTemplate:function(){for(var e=0,t=0;t<n.graphics.length;t++)if(n.graphics[t].id==n.grapichSelected.id){e=t;break}n.onTemplates(e)},onReloadTemplate:function(e){for(var t=0,a=0;a<n.graphics.length;a++)if(n.graphics[a].id==e){t=a;break}n.onTemplates(t)},exportTemplate:function(e){sweet2.loading();var t=new FormData;t.append("userId",window.AppMain.userId),helper.post("/admin/plantillas/periodos/"+e+"/export",t).then((function(e){if(!e.success)throw e.message;var t=document.createElement("a");t.href=e.data.pathname,t.target="_blank",t.click(),sweet2.success({html:e.message})})).catch((function(e){console.log(e),sweet2.error({html:e})}))},onViewerFile:function(e){window.open(e.web_url,"","width=1200,height=800,toolbar=0").focus()},onViewerImage:function(e){n.template=e,bootstrap.Modal.getOrCreateInstance(document.getElementById("modalTemplateView")).show()}}})},init:function(){var e="AppGraphicAdmin",t=document.getElementById(e);if(t){var a=t.getAttribute("data-id");t.removeAttribute("data-id"),AppGraphicAdmin.index({scope:e,periodProductId:a})}}};document.addEventListener("DOMContentLoaded",(function(){AppGraphicAdmin.init()}));