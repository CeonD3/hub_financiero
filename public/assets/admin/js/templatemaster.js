"use strict";var AppAdminTemplate={index:function(e){var t=e.container,n=null;return new Vue({el:"#"+t,data:function(){return{templates:[],template:Object.create({}),index:-1,request:Object.create({}),status:!1}},created:function(){n=this},mounted:function(){n.onInit()},watch:{},computed:{},methods:{onInit:function(){n.onList()},onList:function(){sweet2.loading(),fetch(window.AppFinanceAdmin.api+"/api/admin/master/templates/list",{method:"GET"}).then((function(e){return e.json()})).then((function(e){var t=e.success,a=e.data,s=e.message;if(!t)throw s;for(var r=[],o=0;o<a.templates.length;o++){var i=a.templates[o];i.file&&(i.file=window.AppFinanceAdmin.api+"/template/master/"+i.file),r.push(i)}n.templates=r,sweet2.loading(!1)})).catch((function(e){console.error(e),sweet2.error({text:e})}))},buildStructure:function(e){var t="";return"text"!==e.type&&(t+='<div class="card mb-4 border border-secondary">\n                                    <div class="card-body p-4 bg-white text-dark">\n                                        <div class="mb-2">'.concat(e.name,'</div>\n                                        <div class="mb-2">').concat(void 0!==e.code?e.code:"","</div>\n                                        ").concat(e.html,"\n                                    </div>\n                                </div>")),t},onSaveProcess:function(){sweet2.question({text:"¿Estás seguro de procesar los datos?",onOk:function(){sweet2.loading();var e=new FormData;e.append("structures",n.request.structures),e.append("eid",n.request.eid),e.append("file",n.request.file),e.append("id",n.request.id),e.append("name",n.request.name),e.append("status",n.request.status),e.append("version",n.request.version),fetch(window.AppFinanceAdmin.api+"/api/admin/master/templates/save-process",{method:"POST",body:e}).then((function(e){return e.json()})).then((function(e){var t=e.success,a=(e.data,e.message);if(!t)throw a;n.request=Object.create({}),bootstrap.Modal.getOrCreateInstance(document.getElementById("modalTemplateMaster")).hide(),sweet2.show({type:"success",title:a,onOk:function(){sweet2.loading(),window.location.reload()}})})).catch((function(e){console.error(e),sweet2.error({text:e})}))}})},onSave:function(e){e.preventDefault();var t=new FormData(e.currentTarget);Number(t.get("status"));sweet2.question({text:"¿Estás seguro de procesar los datos?",onOk:function(){sweet2.loading(),fetch(window.AppFinanceAdmin.api+"/api/admin/master/templates/save",{method:"POST",body:t}).then((function(e){return e.json()})).then((function(e){var t=e.success,a=e.data,s=e.message;if(!t)throw s;var r=a.merge_template_structures,o=r.eliminados,i=r.existentes,d=r.nuevos;n.request={structures:JSON.stringify(a.structures),file:a.template.file,id:a.template.id,name:a.template.name,status:a.template.status,version:a.template.version,eid:a.template.eid},bootstrap.Modal.getOrCreateInstance(document.getElementById("mdlForm")).hide(),document.getElementById("frmSave").reset();var c="";c+='<div class="alert alert-success" role="alert">\n                                                <h4 class="alert-heading">Códigos Nuevos!</h4>\n                                                <p>Los elementos de está sección se agregarán en la lista de la edición de los reportes.</p>\n                                                <hr>',d&&d.length>0?d.map((function(e){c+=n.buildStructure(e)})):c+="No hay registros para mostrar.",c+="</div>",c+='<div class="alert alert-danger" role="alert">\n                                                <h4 class="alert-heading">Códigos Eliminados!</h4>\n                                                <p>Los elementos de está sección serán eliminados de la lista de la edición de los reportes.</p>\n                                                <hr>',o&&o.length>0?o.map((function(e){c+=n.buildStructure(e)})):c+="No hay registros para mostrar.",c+="</div>",c+='<div class="alert alert-primary" role="alert">\n                                                <h4 class="alert-heading">Códigos Existentes!</h4>\n                                                <p>Los elementos de está sección permanecerán en la lista de la edición de los reportes.</p>\n                                                <hr>',i&&i.length>0?i.map((function(e){c+=n.buildStructure(e)})):c+="No hay registros para mostrar.",c+="</div>";var l=document.querySelectorAll(".container-response");l&&l.length>0&&l.forEach((function(e){e.innerHTML=c})),bootstrap.Modal.getOrCreateInstance(document.getElementById("modalTemplateMaster")).show(),sweet2.loading(!1)})).catch((function(e){console.error(e),sweet2.error({text:e})}))}})},onForm:function(e){document.getElementById("frmSave").reset(),n.index=e,-1==e?(n.template=Object.create({}),n.status=!1):(n.template=Object.create(n.templates[e]),n.status=1===Number(n.template.status)),document.getElementById("lblFile").innerText=n.template.file?n.template.file:"Seleccionar Archivo",bootstrap.Modal.getOrCreateInstance(document.getElementById("mdlForm")).show()},onDelete:function(e){var t=n.templates[e].id;sweet2.question({text:"¿Estás seguro de eliminar esta plantilla?",onOk:function(){sweet2.loading();var e=new FormData;e.append("id",t),fetch(window.AppFinanceAdmin.api+"/api/admin/master/templates/remove",{method:"POST",body:e}).then((function(e){return e.json()})).then((function(e){var t=e.success,a=(e.data,e.message);if(!t)throw a;sweet2.show({type:"success",text:a,onOk:function(){n.onList()}})})).catch((function(e){console.error(e),sweet2.error({text:e})}))}})},onReadFile:function(e){e.target.files.length>0&&(document.getElementById("lblFile").innerText=e.target.files[0].name)}}})},init:function(){var e="AppAdminTemplate";document.getElementById(e)&&AppAdminTemplate.index({container:e})}};document.addEventListener("DOMContentLoaded",AppAdminTemplate.init());