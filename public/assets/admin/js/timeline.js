"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var AppTimeLineAdmin={index:function(e){var t={};return new Vue({el:"#"+e,data:function(){return{templates:[],labels:[],loadList:!1,search:""}},created:function(){t=this},mounted:function(){t.initialize()},watch:{},computed:{items:function(){return t.filteredItems(t.templates)}},methods:{initialize:function(){t.onListService()},onStoreTemplate:function(e){e.preventDefault(),sweet2.loading();var n=new FormData(e.target);n.append("companyId",AppMain.companyId),helper.post("/admin/linea-tiempo/store",n).then((function(n){if(!n.success)throw n.message;bootstrap.Modal.getOrCreateInstance(document.getElementById("modalTemplate")).hide(),e.target.reset(),t.onListService(),sweet2.success({text:n.message})})).catch((function(e){sweet2.error({html:e})})),console.log(e)},onListService:function(){t.loadList=!1,helper.post("/admin/linea-tiempo/list").then((function(e){if(!e.success)throw e.message;t.templates=e.data.templates,t.onSelect2(e.data.labels),t.loadList=!0})).catch((function(e){sweet2.error({html:e})}))},onSelect2:function(e){var t=[];e.forEach((function(e){t.push({id:e.id,text:e.name})})),$(".js-select2").select2({placeholder:"SELECCIONE",tags:!0,dropdownParent:$("#modalTemplate"),data:t})},filteredItems:function(e){return e.filter((function(e,n){var o="";return null!=e.name&&(o=e.name),-1!==(o=o.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()).indexOf(t.search.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase())}))}}})},show:function(e,t){var n={};return new Vue({el:"#"+e,data:function(){return{templates:[],loadList:!1,myDropzone:{},template:{},search:"",fileId:0}},created:function(){n=this},mounted:function(){n.initialize()},watch:{},computed:{items:function(){return n.filteredItems(n.templates)}},methods:_defineProperty({initialize:function(){n.onListService(),n.myDropzone=new Dropzone("#kt_dropzonejs_example_1",{url:"/admin/linea-tiempo/"+t+"/upload",paramName:"file",maxFiles:1,maxFilesize:20,addRemoveLinks:!0,uploadMultiple:!0,acceptedFiles:".ppt,.pptx"}),n.myDropzone.on("sending",(function(e,t,n){n.append("companyId",AppMain.companyId)})),n.myDropzone.on("complete",(function(e){0==n.myDropzone.getUploadingFiles().length&&0==n.myDropzone.getQueuedFiles().length&&console.log("complete all");var t=JSON.parse(e.xhr.response),o=t.data.templates;sweet2.show({type:"success",title:t.message,html:"<h5>Recuerda</h5><p>De ingresar al panel complementario para visualizar las etiquetas de los atributos del producto</p>",confirmButtonText:"Ingresar",onOk:function(){o.length>0&&n.onViewerFile(o[0])}}),n.onListService()}))},onUploadFile:function(){n.myDropzone.processQueue()},onStoreTemplate:function(e){e.preventDefault(),sweet2.loading();var t=new FormData(e.target);t.append("companyId",AppMain.companyId),helper.post("/admin/linea-tiempo/store",t).then((function(t){if(!t.success)throw t.message;bootstrap.Modal.getOrCreateInstance(document.getElementById("modalTemplate")).hide(),e.target.reset(),n.onListService(),sweet2.success({text:t.message})})).catch((function(e){sweet2.error({html:e})})),console.log(e)},onListService:function(){n.loadList=!1,helper.post("/admin/linea-tiempo/"+t+"/childrens").then((function(e){if(!e.success)throw e.message;n.templates=e.data.templates,n.template=e.data.template,KTMenu.updateDropdowns(),n.loadList=!0})).catch((function(e){sweet2.error({html:e})}))},filteredItems:function(e){return e.filter((function(e,t){var o="";return null!=e.name&&(o=e.name),-1!==(o=o.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()).indexOf(n.search.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase())}))},onRemove:function(e){sweet2.question({title:"¿Estás seguro de eliminar este elemento?",onOk:function(){sweet2.loading();var t=new FormData;t.append("companyId",AppMain.companyId),helper.post("/admin/plantillas/"+e+"/remove",t).then((function(e){if(!e.success)throw e.message;n.onListService(),sweet2.success({text:e.message})})).catch((function(e){sweet2.error({html:e})}))}})},onFormDuplicate:function(e){n.fileId=e;for(var t="",o=0;o<n.templates.length;o++)if(n.templates[o].id==e){t=n.templates[o].name;break}document.querySelector("#nameForm").value=(new Date).getTime()+"-"+t,bootstrap.Modal.getOrCreateInstance(document.getElementById("modalFileDuplicate")).show()},onDuplicate:function(e){e.preventDefault(),sweet2.loading();var t=new FormData(e.target);t.append("companyId",AppMain.companyId),helper.post("/admin/plantillas/"+n.fileId+"/duplicate",t).then((function(t){if(!t.success)throw t.message;n.onListService(),bootstrap.Modal.getOrCreateInstance(document.getElementById("modalFileDuplicate")).hide(),e.target.reset(),sweet2.success({text:t.message})})).catch((function(e){sweet2.error({html:e})}))},onViewerFile:function(e){console.log(e),window.open(e.web_url,"","width=1200,height=800,toolbar=0").focus()},onRemoveFolder:function(){sweet2.question({title:"¿Estás seguro de eliminar este elemento?",onOk:function(){sweet2.loading();var e=new FormData;e.append("companyId",AppMain.companyId),helper.post("/admin/plantillas/"+t+"/remove",e).then((function(e){if(!e.success)throw e.message;sweet2.success({text:e.message}),setTimeout((function(){sweet2.loading(),location.href="/admin/linea-tiempo"}),2e3)})).catch((function(e){sweet2.error({html:e})}))}})}},"onViewerFile",(function(e){window.open(e.web_url,"","width=1200,height=800,toolbar=0").focus()}))})},init:function(){var e="AppTimeLineAdmin",t="AppTimeLineShowAdmin";if(document.getElementById(e)&&AppTimeLineAdmin.index(e),document.getElementById(t)){var n=document.getElementById(t).getAttribute("data-id");AppTimeLineAdmin.show(t,n)}}};document.addEventListener("DOMContentLoaded",(function(){AppTimeLineAdmin.init()}));